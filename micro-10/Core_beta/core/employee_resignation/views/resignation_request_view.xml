<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <data>
        <record id="view_resignation_request_tree" model="ir.ui.view">
            <field name="name">resignation.request.tree</field>
            <field name="model">resignation.request</field>
            <field name="type">tree</field>
            <field name="priority" eval="8"/>
            <field name="arch" type="xml">
            <tree string="Resignation Request">
                <field name="name"/>
                <field name="employee_id"/>
                <field name="department_id"/>
                <field name="join_date"/>
                <field name="resignation_date"/>
                <field name="state"/>
            </tree>
            </field>
        </record>

        <record id="view_resignation_request_form" model="ir.ui.view">
            <field name="name">resignation.request.form</field>
            <field name="model">resignation.request</field>
            <field name="type">form</field>
            <field name="priority" eval="8"/>
            <field name="arch" type="xml">
            <form string="Resignation Request">
                <header>
                    <button string="Submit to Manager"
                        icon="" states="draft" type="object" name="action_submit"/>
                    <button string="Approve" states="waiting_approval"
                        type="object" name="action_approve_department_manager"/>
                    <button string="Reject" states="waiting_approval"
                        type="object" name="action_reject"/>
                    <button string="Approve" icon=""
                        states="waiting_hr_approval" type="object"
                        name="action_approve_hr_manager"/>
                    <button string="Reject" states="waiting_hr_approval"
                        type="object" name="action_reject"/>
                    <button string="Change Notice Period" icon=""
                        states="approved" type="action"
                        name="%(act_open_change_notice_period_view)d"
                        groups="hr.group_hr_manager"
                        context="{'default_current_notice_id': notice_period_id}"/>
                    <field name="state" widget="statusbar"
                        statusbar_visible="draft,waiting_approval,approved"/>
                </header>
                <sheet>
                    <div class="oe_title">
                        <h1>
                            <field name="name" readonly="1" />
                        </h1>
                    </div>
                    <group>
                        <group>
                            <field name="employee_id" required="1"
                                attrs="{'readonly': [('state','not in', ['draft'])]}"
                                />
                            <field name="join_date" readonly="0"
                                attrs="{'readonly': [('state','not in', ['draft'])]}"/>
                            <field name="notice_period_id"
                                attrs="{'readonly': [('state','not in', ['draft'])]}"
                                options='{"no_open": True, "no_create": True}'/>
                        <field name="resignation_note" nolabel="0"
                            required="1" attrs="{'readonly': [('state','not in', ['draft'])]}" />
                        </group>
                        <group>
                            <field name="department_id" readonly="0"
                                options='{"no_open": True, "no_create": True}'
                                attrs="{'readonly': [('state','not in', ['draft'])]}"/>
                            <field name="resignation_date"
                                 attrs="{'readonly': [('state','not in', ['draft'])]}"/>
                             <field name="cessation_date"
                                 attrs="{'readonly': [('state','not in', ['draft'])]}"/>
                        </group>
                    </group>
                    <group >
                        <group string="Department Manager Comment"
                            attrs="{'invisible': [('state','=', 'draft')]}">
                            <field name="department_comment" nolabel="1" attrs="{'readonly': [('state','in', ['approved', 'reject'])]}"/>
                        </group>
                        <group string="HR Comment"
                            attrs="{'invisible': [('state', 'in', ['draft', 'waiting_approval'])]}">
                            <field name="hr_comment" nolabel="1"  attrs="{'readonly': [('state','in', ['approved', 'reject'])]}"/>
                        </group>
                    </group>
                </sheet>
                <div class="oe_chatter">
                    <field name="message_follower_ids" widget="mail_followers"/>
                    <field name="message_ids" widget="mail_thread"/>
                </div>
            </form>
        </field>
        </record>

        <record id="view_resignation_request_search" model="ir.ui.view">
            <field name="name">resignation.request.search</field>
            <field name="model">resignation.request</field>
            <field name="type">search</field>
            <field name="priority" eval="8"/>
            <field name="arch" type="xml">
            <search string="Resignation Request">
                <field name="name"/>
                <field name="employee_id"/>
                <field name="department_id"/>
                <field name="resignation_date"/>
                <filter string="Draft" name="draft" domain="[('state','=','draft')]"/>
                <filter string="Waiting Approval" name="waiting_approval"
                    domain="[('state','=','waiting_approval')]"/>
                <filter string="Waiting HR Approval" name="waiting_hr_approval"
                    domain="[('state','=','waiting_hr_approval')]"/>
                <filter string="Approved" name="approved"
                    domain="[('state','=','approved')]"/>
                <filter string="Reject" name="reject"
                    domain="[('state','=','reject')]"/>
                <group expand="0" string="Group By">
                    <filter string="Department" domain="[]" context="{'group_by':'department_id'}"/>
                    <filter string="Status" domain="[]" context="{'group_by':'state'}"/>
                    <filter string="Employee" domain="[]" context="{'group_by':'employee_id'}"/>
                </group>
            </search>
            </field>
        </record>

        <record model="ir.actions.act_window" id="act_open_resignation_request_view">
            <field name="name">Resignation Request</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">resignation.request</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="search_view_id" ref="view_resignation_request_search"/>
            <field name="domain">[]</field>
            <field name="context">{}</field>
        </record>

        <record model="ir.actions.act_window.view" id="act_open_resignation_request_view_form">
            <field name="act_window_id" ref="act_open_resignation_request_view"/>
            <field name="sequence" eval="20"/>
            <field name="view_mode">form</field>
            <field name="view_id" ref="view_resignation_request_form"/>
        </record>

        <record model="ir.actions.act_window.view" id="act_open_resignation_request_view_tree">
            <field name="act_window_id" ref="act_open_resignation_request_view"/>
            <field name="sequence" eval="10"/>
            <field name="view_mode">tree</field>
            <field name="view_id" ref="view_resignation_request_tree"/>
        </record>

        <record model="ir.actions.act_window" id="act_open_resignation_approve_view">
            <field name="name">Resignation To Approve</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">resignation.request</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="search_view_id" ref="view_resignation_request_search"/>
            <field name="domain">[('state', 'in', ['waiting_approval', 'waiting_hr_approval'])]</field>
            <field name="context">{}</field>
        </record>


        <menuitem
            id="menu_resignation_main"
            name="Resignation"
            parent="sg_hr_employee.menu_root_hr_parent"
            sequence="5"/>

        <menuitem id="menu_resignation_request"
            parent="menu_resignation_main"
            sequence="1"
            action="act_open_resignation_request_view"/>

        <menuitem id="menu_resignation_approve"
            parent="menu_resignation_main"
            sequence="1"
            action="act_open_resignation_approve_view"/>

    </data>
</odoo>
